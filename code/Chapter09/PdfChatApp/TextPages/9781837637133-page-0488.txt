Chapter 10 455 ILoggerFactory loggerFactory) { _clientFactory = clientFactory; _logger = loggerFactory.CreateLogger<ScrapeAmazonFunction>(); } [Function(nameof(ScrapeAmazonFunction))] public async Task Run( // Every hour. [TimerTrigger("0 0 * * * *")] TimerInfo timer) { _logger.LogInformation($"C# Timer trigger function executed at { DateTime.UtcNow}."); _logger.LogInformation( $"C# Timer trigger function next three occurrences at: { timer.ScheduleStatus?.Next}."); HttpClient client = _clientFactory.CreateClient("Amazon"); HttpResponseMessage response = await client.GetAsync(relativePath); _logger.LogInformation( $"Request: GET {client.BaseAddress}{relativePath}"); if (response.IsSuccessStatusCode) { _logger.LogInformation("Successful HTTP request."); // Read the content from a GZIP stream into a string. Stream stream = await response.Content.ReadAsStreamAsync(); GZipStream gzipStream = new(stream, CompressionMode.Decompress); StreamReader reader = new(gzipStream); string page = reader.ReadToEnd(); // Extract the Best Sellers Rank. int posBsr = page.IndexOf("Best Sellers Rank"); string bsrSection = page.Substring(posBsr, 45); // bsrSection will be something like: // "Best Sellers Rank: </span> #22,258 in Books (" // Get the position of the # and the following space. 