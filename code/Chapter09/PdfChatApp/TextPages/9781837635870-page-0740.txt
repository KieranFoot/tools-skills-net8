Chapter 14 721 Specifying problem details A feature added in ASP.NET Core 2.1 and later is an implementation of a web standard for specifying problem details. In Web API controllers decorated with [ApiController] in a project where com- patibility with ASP.NET Core 2.2 or later is enabled, action methods that return IActionResult and return a client error status code, that is, 4xx, will automatically include a serialized instance of the ProblemDetails class in the response body. If you want to take control, then you can create a ProblemDetails instance yourself and include additional information. Letâ€™s simulate a bad request that needs custom data returned to the client: 1. At the top of the implementation of the Delete action method, add statements to check if the id matches the literal string value "bad", and if so, then return a custom ProblemDetails object, as shown in the following code: // Take control of problem details. if (id == "bad") { ProblemDetails problemDetails = new() { Status = StatusCodes.Status400BadRequest, Type = "https://localhost:5151/customers/failed-to-delete", Title = $"Customer ID {id} found but failed to delete.", Detail = "More details like Company Name, Country and so on.", Instance = HttpContext.Request.Path }; return BadRequest(problemDetails); // 400 Bad Request } 2. You will test this functionality later. Controlling XML serialization In Program.cs, we added the XmlSerializer so that our Web API service can return XML as well as JSON if the client requests that. However, the XmlSerializer cannot serialize interfaces, and our entity classes use ICollection<T> Customer class to define related child entities. This causes a warning at runtime, for example, for the and its Orders property, as shown in the following output: warn: Microsoft.AspNetCore.Mvc.Formatters.XmlSerializerOutputFormatter[1] An error occurred while trying to create an XmlSerializer for the type 'Northwind.EntityModels.Customer'. System.InvalidOperationException: There was an error reflecting type 'Northwind.EntityModels.Customer'. 