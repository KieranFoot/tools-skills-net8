Building and Consuming Web Services 736 1. In the Northwind.Mvc project, in Program.cs, import the namespace for setting a media type header value, as shown in the following code: using System.Net.Http.Headers; // To use MediaTypeWithQualityHeaderValue. 2. In the Northwind.Mvc project, in Program.cs, before calling the Build method, add a statement to enable HttpClientFactory with a named client to make calls to the Northwind Web API service using HTTPS on port 5151 and request JSON as the default response format, as shown in the following code: builder.Services.AddHttpClient(name: "Northwind.WebApi", configureClient: options => { options.BaseAddress = new Uri("https://localhost:5151/"); options.DefaultRequestHeaders.Accept.Add( new MediaTypeWithQualityHeaderValue( mediaType: "application/json", quality: 1.0)); }); Getting customers as JSON in the controller We can now create an MVC controller action method that: • Uses the factory to create an HTTP client. GET request for customers. • Makes a • Deserializes the JSON response using convenient extension methods introduced with .NET 5 System.Net.Http.Json assembly and namespace. in the Let’s go: 1. In the Northwind.Mvc project, in the Controllers folder, in HomeController.cs, declare a field for storing the HTTP client factory, as shown in the following code: private readonly IHttpClientFactory _clientFactory; 2. Set the field in the constructor, as shown highlighted in the following code: public HomeController( ILogger<HomeController> logger, NorthwindContext db, IHttpClientFactory httpClientFactory) { _logger = logger; _db = db; _clientFactory = httpClientFactory; } 