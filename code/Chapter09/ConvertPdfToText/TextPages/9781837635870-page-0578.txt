Chapter 10 559 Each item in foreach is an instance of the Category class, which has a property named Products, that is, the list of products in that category. Since the original query is only selected from the Categories table, this property is empty for each category. Enabling lazy loading Lazy loading was introduced in EF Core 2.1, and it can automatically load missing related data. To enable lazy loading, developers must: • Reference a NuGet package for proxies. • Configure lazy loading to use a proxy. Let’s see this in action: 1. In the WorkingWithEFCore project, add a package reference for EF Core proxies, as shown in the following markup: <PackageReference Version="8.0.0" Include="Microsoft.EntityFrameworkCore.Proxies" /> 2. Build the WorkingWithEFCore project to restore packages. NorthwindDb.cs, at the bottom of the OnConfiguring method, call an extension method to 3. In use lazy loading proxies, as shown in the following code: optionsBuilder.UseLazyLoadingProxies(); Now, every time the loop enumerates and an attempt is made to read the Products property, the lazy loading proxy will check if they are loaded. If they’re not loaded, it will load them for us “lazily” by executing a SELECT statement to load just that set of products for the current category, and then the correct count will be returned to the output. 4. Run the code and note that the product counts are now correct. But you will see that the problem with lazy loading is that multiple round trips to the database server are required to eventually fetch all the data. For example, getting all the categories and then getting the products for the first category, Beverages, requires the execution of two SQL commands, as shown in the following partial output: dbug: 05/03/2022 13:41:40.221 RelationalEventId.CommandExecuting[20100] (Microsoft.EntityFrameworkCore.Database.Command) Executing DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30'] SELECT "c"."CategoryId", "c"."CategoryName", "c"."Description" FROM "Categories" AS "c" dbug: 05/03/2022 13:41:40.331 RelationalEventId.CommandExecuting[20100] (Microsoft.EntityFrameworkCore.Database.Command) Executing DbCommand [Parameters=[@__p_0='1'], CommandType='Text', CommandTimeout='30'] 